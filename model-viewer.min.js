// @ts-nocheck
import*as THREE from"https://cdn.jsdelivr.net/npm/three@r128/build/three.module.js";import{GLTFLoader}from"https://cdn.jsdelivr.net/npm/three@r128/examples/jsm/loaders/GLTFLoader.js";class LocalModelViewer{constructor(e){this.container=document.getElementById(e),this.container&&(this.initScene(),this.setupLighting(),this.loadModel(),this.setupEventListeners(),this.animate())}initScene(){this.scene=new THREE.Scene,this.scene.background=new THREE.Color(16119285),this.camera=new THREE.PerspectiveCamera(75,this.container.clientWidth/this.container.clientHeight,.1,1e3),this.camera.position.z=3,this.renderer=new THREE.WebGLRenderer({antialias:!0,alpha:!0}),this.renderer.setSize(this.container.clientWidth,this.container.clientHeight),this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.shadowMap.enabled=!0,this.container.appendChild(this.renderer.domElement),this.isDragging=!1,this.previousMousePosition={x:0,y:0},this.rotation={x:0,y:0},this.model=null}setupLighting(){const e=new THREE.AmbientLight(16777215,.7);this.scene.add(e);const t=new THREE.DirectionalLight(16777215,.9);t.position.set(5,10,7),t.castShadow=!0,t.shadow.mapSize.width=2048,t.shadow.mapSize.height=2048,this.scene.add(t);const i=new THREE.PointLight(16755336,.5);i.position.set(-8,5,5),this.scene.add(i);const o=new THREE.PointLight(8965375,.4);o.position.set(0,5,-8),this.scene.add(o)}loadModel(){(new GLTFLoader).load("./model/base.glb",(e=>{this.model=e.scene;const t=(new THREE.Box3).setFromObject(this.model),i=t.getCenter(new THREE.Vector3),o=t.getSize(new THREE.Vector3);this.model.position.sub(i);const s=Math.max(o.x,o.y,o.z),n=s>0?2/s:1;this.model.scale.multiplyScalar(n),this.model.traverse((e=>{e.isMesh&&(e.castShadow=!0,e.receiveShadow=!0)})),this.scene.add(this.model),console.log("Model loaded successfully (offline mode)")}),(e=>{const t=e.total>0?(e.loaded/e.total*100).toFixed(2):0;console.log("Loading progress:",t+"%")}),(e=>{console.error("Error loading model:",e),this.createFallbackMannequin()}))}createFallbackMannequin(){const e=new THREE.Group,t=new THREE.SphereGeometry(.3,32,32),i=new THREE.MeshPhongMaterial({color:15784136}),o=new THREE.Mesh(t,i);o.position.y=1.6,o.castShadow=!0,o.receiveShadow=!0,e.add(o);const s=new THREE.CylinderGeometry(.25,.2,.8,32),n=new THREE.Mesh(s,i);n.position.y=.8,n.castShadow=!0,n.receiveShadow=!0,e.add(n);const a=new THREE.CylinderGeometry(.08,.08,.7,16),r=new THREE.Mesh(a,i);r.position.set(-.4,1.1,0),r.rotation.z=Math.PI/6,r.castShadow=!0,r.receiveShadow=!0,e.add(r);const h=new THREE.Mesh(a,i);h.position.set(.4,1.1,0),h.rotation.z=-Math.PI/6,h.castShadow=!0,h.receiveShadow=!0,e.add(h);const d=new THREE.CylinderGeometry(.1,.1,.8,16),c=new THREE.Mesh(d,i);c.position.set(-.15,0,0),c.castShadow=!0,c.receiveShadow=!0,e.add(c);const l=new THREE.Mesh(d,i);l.position.set(.15,0,0),l.castShadow=!0,l.receiveShadow=!0,e.add(l);const m=new THREE.ConeGeometry(.3,.6,32),u=new THREE.MeshPhongMaterial({color:3066993}),E=new THREE.Mesh(m,u);E.position.y=.5,E.castShadow=!0,E.receiveShadow=!0,e.add(E),this.model=e,this.scene.add(this.model),console.log("Fallback mannequin created")}setupEventListeners(){this.container.addEventListener("mousedown",(e=>this.onMouseDown(e))),this.container.addEventListener("mousemove",(e=>this.onMouseMove(e))),this.container.addEventListener("mouseup",(e=>this.onMouseUp(e))),this.container.addEventListener("mouseleave",(e=>this.onMouseLeave(e))),this.container.addEventListener("touchstart",(e=>this.onTouchStart(e))),this.container.addEventListener("touchmove",(e=>this.onTouchMove(e))),this.container.addEventListener("touchend",(e=>this.onTouchEnd(e))),window.addEventListener("resize",(()=>this.onWindowResize()))}onMouseDown(e){this.isDragging=!0,this.previousMousePosition={x:e.clientX,y:e.clientY}}onMouseMove(e){if(!this.isDragging)return;const t=e.clientX-this.previousMousePosition.x,i=e.clientY-this.previousMousePosition.y;this.rotation.y+=.005*t,this.rotation.x+=.005*i,this.rotation.x=Math.max(-Math.PI/2,Math.min(Math.PI/2,this.rotation.x)),this.previousMousePosition={x:e.clientX,y:e.clientY}}onMouseUp(e){this.isDragging=!1}onMouseLeave(e){this.isDragging=!1}onTouchStart(e){this.isDragging=!0,this.previousMousePosition={x:e.touches[0].clientX,y:e.touches[0].clientY}}onTouchMove(e){if(!this.isDragging)return;e.preventDefault();const t=e.touches[0].clientX-this.previousMousePosition.x,i=e.touches[0].clientY-this.previousMousePosition.y;this.rotation.y+=.005*t,this.rotation.x+=.005*i,this.rotation.x=Math.max(-Math.PI/2,Math.min(Math.PI/2,this.rotation.x)),this.previousMousePosition={x:e.touches[0].clientX,y:e.touches[0].clientY}}onTouchEnd(e){this.isDragging=!1}onWindowResize(){const e=this.container.clientWidth,t=this.container.clientHeight;this.camera.aspect=e/t,this.camera.updateProjectionMatrix(),this.renderer.setSize(e,t)}animate=()=>{requestAnimationFrame(this.animate),this.model&&(this.isDragging||(this.rotation.y+=.003),this.model.rotation.x=this.rotation.x,this.model.rotation.y=this.rotation.y),this.renderer.render(this.scene,this.camera)}}document.addEventListener("DOMContentLoaded",(()=>{const e=document.getElementById("googleModelViewer");if(customElements.get("model-viewer")){console.log("Using Google Model Viewer"),e.style.display="block";const t=document.getElementById("modelViewer");t&&(t.style.display="none")}else{console.log("Using local Three.js viewer");document.querySelector(".model-viewer-wrapper")&&(e.style.display="none",document.getElementById("modelViewer").style.display="block"),new LocalModelViewer("modelViewer")}}));